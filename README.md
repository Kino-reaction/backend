## О проекте в этом репозитории

Backend проекта Кинореакция. 

## API Сервер

REST API с информацией о фильмах, актерах.

### Запуск

Убедитесь что на вашей системе установлена mariadb или mysql.<br/>
Переместитесь в директорию приложения, создайтие `.env` файл и заполните следующими переменными:
```sh
# .env
# пользователь бд, с необходимыми правами для бд
DB_USER=kino
# пароль
DB_PASSWORD=123
# имя базы данных, предварительно создана командой create database <name>; в mysql cli
DB_DATABASE=kino
```

Выполните следующие команды:
1. `npm install` - устанавливает зависимости 
2. `npm run generate::secret` - генерирует secret key
3. `npm run migrate` - применят миграции
4. `npm run seed` - заполняет бд начальными данными
5. `npm run start::debug` или `npm run start` — запускает сервер

## Скрапер
Извлекает информацию о фильмах/актерах с [Кинопоиск](https://kinopoisk.ru). Рекомендуется использовать с <a href="#динамический-прокси-сервер">динамическим прокси</a> сервером. Для решения каптч, которые периодически появляются в процессе скрапинга, используется сервис [rucaptcha.ru](https://rucaptcha.ru).

### Запуск
1. Добавьте переменную RUCAPTCHA_KEY в `.env` файл
```sh
# .env
...
# Ключ
RUCAPTCHA_KEY=1646dc3465760bb1d34cf9e78ace6b12
# Необязательные параметры
# максимальное количество воркеров в кластере
SCRAPER_MAX_CONCURRENCY=4
# headless режим
SCRAPER_HEADLESS=true
# Прокси сервер, если переменная определена, то для всех запросов используется прокси, может быть в формате http://login:password@address
SCRAPER_PROXY=http://localhost:8000
...
```
2. Выполните `npm run scrape` или `npm run scrape::debug`

## Динамический прокси-сервер
Ротирует адреса прокси из списка прокси серверов с указанным временным интервалом
### Запуск
1. Добавьте следуюшие переменные в `.env` файл
```sh
# .env
...
# Список прокси серверов, разделенных запятой
ROTATOR_PROXY_LIST=http://login:password@192.168.0.1:3000,http://login:password@192.168.0.2:3001,http://login:password@192.168.0.2:3002
# Частота изменения прокси серверов(m, h, d, s, etc.)
ROTATOR_FREQUENCY=15m
# Порт
ROTATOR_PORT=8000
...
# И теперь укажем в качестве прокси для скрапера наш сервер
SCRAPER_PROXY=http://localhost:8000

```
2. Выполните `npm run rotate` для запуска сервера


